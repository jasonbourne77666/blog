# Docker æ„å»ºå’Œæ¨é€è„šæœ¬ä½¿ç”¨æŒ‡å—

è¿™ä¸ªç›®å½•åŒ…å«ç”¨äºè‡ªåŠ¨åŒ–æ„å»ºå’Œæ¨é€ Docker é•œåƒåˆ°é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡çš„ JavaScript è„šæœ¬ã€‚

## è„šæœ¬åˆ—è¡¨

### 1. `build-and-push.js` - å®Œæ•´åŠŸèƒ½è„šæœ¬

åŠŸèƒ½å¼ºå¤§çš„æ„å»ºå’Œæ¨é€è„šæœ¬ï¼Œä½¿ç”¨ Node.js ç¼–å†™ï¼Œæ”¯æŒå¤šç§é€‰é¡¹å’Œæ¨¡å¼ã€‚

#### ä½¿ç”¨æ–¹æ³•

```bash
# åŸºæœ¬ç”¨æ³• - ä½¿ç”¨æ—¶é—´æˆ³ç‰ˆæœ¬æ„å»ºå¹¶æ¨é€
node ./scripts/docker/build-and-push.js

# æˆ–è€…ä½¿ç”¨ npm è„šæœ¬
npm run docker:build
```

#### é«˜çº§ç”¨æ³•

```bash
# æŒ‡å®šç‰ˆæœ¬å·
node ./scripts/docker/build-and-push.js -v v1.2.3

# æŒ‡å®šç‰ˆæœ¬å·å¹¶æ·»åŠ  latest æ ‡ç­¾
node ./scripts/docker/build-and-push.js -v v1.2.3 -t latest

# ä¸ä½¿ç”¨ç¼“å­˜æ„å»º
node ./scripts/docker/build-and-push.js --no-cache -v v1.2.3

# ä»…æ„å»ºï¼Œä¸æ¨é€
node ./scripts/docker/build-and-push.js --build-only -v v1.2.3

# ä»…æ¨é€å·²å­˜åœ¨çš„é•œåƒ
node ./scripts/docker/build-and-push.js --push-only v1.2.3

# æŸ¥çœ‹å¸®åŠ©
node ./scripts/docker/build-and-push.js --help
```

#### æ”¯æŒçš„å‚æ•°

- `-v, --version VERSION`: æŒ‡å®šé•œåƒç‰ˆæœ¬æ ‡ç­¾
- `-t, --tag TAG`: é¢å¤–çš„æ ‡ç­¾ï¼ˆå¦‚ latestï¼‰
- `--no-cache`: æ„å»ºæ—¶ä¸ä½¿ç”¨ç¼“å­˜
- `--build-only`: ä»…æ„å»ºï¼Œä¸æ¨é€
- `--push-only VERSION`: ä»…æ¨é€æŒ‡å®šç‰ˆæœ¬çš„é•œåƒ
- `-h, --help`: æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯

### 2. `quick-build.js` - å¿«é€Ÿæ„å»ºè„šæœ¬

ç®€åŒ–ç‰ˆæœ¬çš„æ„å»ºè„šæœ¬ï¼Œä½¿ç”¨ Node.js ç¼–å†™ï¼Œç”¨äºå¿«é€Ÿæ„å»ºå’Œæ¨é€ã€‚

#### ä½¿ç”¨æ–¹æ³•

```bash
# ä½¿ç”¨æ—¶é—´æˆ³ç‰ˆæœ¬
node ./scripts/docker/quick-build.js

# æŒ‡å®šç‰ˆæœ¬å·
node ./scripts/docker/quick-build.js v1.2.3

# æˆ–è€…ä½¿ç”¨ npm è„šæœ¬
npm run docker:quick
npm run docker:quick v1.2.3
```

## å‰ç½®è¦æ±‚

1. **Docker å·²å®‰è£…å¹¶è¿è¡Œ**
   ```bash
   docker --version
   docker info
   ```

2. **å·²ç™»å½•é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡**
   ```bash
   docker login crpi-6a105b9464djyzkq.cn-chengdu.personal.cr.aliyuncs.com
   ```

3. **åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œè„šæœ¬**
   ç¡®ä¿å½“å‰ç›®å½•åŒ…å« `package.json` å’Œ `Dockerfile`

## é•œåƒä»“åº“é…ç½®

å½“å‰é…ç½®çš„é•œåƒä»“åº“ä¿¡æ¯ï¼š
- **ä»“åº“åœ°å€**: `crpi-6a105b9464djyzkq.cn-chengdu.personal.cr.aliyuncs.com`
- **å‘½åç©ºé—´**: `jasonblog`
- **é•œåƒåç§°**: `blog`

å®Œæ•´é•œåƒåœ°å€æ ¼å¼ï¼š
```
crpi-6a105b9464djyzkq.cn-chengdu.personal.cr.aliyuncs.com/jasonblog/blog:ç‰ˆæœ¬å·
```

## è‡ªåŠ¨åŒ–åŠŸèƒ½

è„šæœ¬ä¼šè‡ªåŠ¨æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š

1. âœ… **é¢„æ£€æŸ¥**
   - æ£€æŸ¥ Docker æ˜¯å¦è¿è¡Œ
   - æ£€æŸ¥æ˜¯å¦åœ¨é¡¹ç›®æ ¹ç›®å½•
   - æ£€æŸ¥æ˜¯å¦å·²ç™»å½•é˜¿é‡Œäº‘é•œåƒä»“åº“

2. ğŸ”¨ **æ„å»ºé•œåƒ**
   - ä½¿ç”¨é¡¹ç›®æ ¹ç›®å½•çš„ Dockerfile æ„å»ºé•œåƒ
   - æ”¯æŒç¼“å­˜å’Œæ— ç¼“å­˜æ„å»º

3. ğŸ“¤ **æ¨é€é•œåƒ**
   - æ¨é€åˆ°é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡
   - æ”¯æŒå¤šæ ‡ç­¾æ¨é€

4. ğŸ“ **æ›´æ–°é…ç½®**
   - è‡ªåŠ¨æ›´æ–° `docker-compose.yml` ä¸­çš„é•œåƒç‰ˆæœ¬
   - åˆ›å»ºé…ç½®æ–‡ä»¶å¤‡ä»½

5. ğŸ§¹ **æ¸…ç†å·¥ä½œ**
   - æ¸…ç†æœªä½¿ç”¨çš„ Docker é•œåƒ
   - é‡Šæ”¾ç£ç›˜ç©ºé—´

## ç‰ˆæœ¬ç­–ç•¥

### é»˜è®¤ç‰ˆæœ¬å·æ ¼å¼
å¦‚æœä¸æŒ‡å®šç‰ˆæœ¬å·ï¼Œè„šæœ¬ä¼šä½¿ç”¨æ—¶é—´æˆ³æ ¼å¼ï¼š
```
v20231215_143052
```

### æ¨èç‰ˆæœ¬å·æ ¼å¼
- **è¯­ä¹‰åŒ–ç‰ˆæœ¬**: `v1.0.0`, `v1.2.3`
- **å‘å¸ƒç‰ˆæœ¬**: `v2023.12.15`, `v2024.01.01`
- **ç‰¹æ€§ç‰ˆæœ¬**: `v1.2.3-beta`, `v1.2.3-alpha`

## å¸¸è§é—®é¢˜

### Q: å¦‚ä½•ä¿®æ”¹é•œåƒä»“åº“åœ°å€ï¼Ÿ
A: ç¼–è¾‘è„šæœ¬æ–‡ä»¶ä¸­çš„ CONFIG å¯¹è±¡ï¼š
```javascript
const CONFIG = {
    REGISTRY_HOST: 'ä½ çš„ä»“åº“åœ°å€',
    NAMESPACE: 'ä½ çš„å‘½åç©ºé—´',
    IMAGE_NAME: 'ä½ çš„é•œåƒåç§°'
};
```

### Q: æ„å»ºå¤±è´¥æ€ä¹ˆåŠï¼Ÿ
A: æ£€æŸ¥ä»¥ä¸‹é¡¹ç›®ï¼š
1. Docker æ˜¯å¦æ­£å¸¸è¿è¡Œ
2. Dockerfile è¯­æ³•æ˜¯å¦æ­£ç¡®
3. é¡¹ç›®ä¾èµ–æ˜¯å¦å®Œæ•´
4. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸

### Q: æ¨é€å¤±è´¥æ€ä¹ˆåŠï¼Ÿ
A: æ£€æŸ¥ä»¥ä¸‹é¡¹ç›®ï¼š
1. æ˜¯å¦å·²ç™»å½•é˜¿é‡Œäº‘é•œåƒä»“åº“
2. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
3. é•œåƒä»“åº“æƒé™æ˜¯å¦æ­£ç¡®

### Q: å¦‚ä½•å›æ»šåˆ°ä¹‹å‰çš„ç‰ˆæœ¬ï¼Ÿ
A: ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š
```bash
# ä»…æ¨é€å·²å­˜åœ¨çš„æ—§ç‰ˆæœ¬é•œåƒ
node ./scripts/docker/build-and-push.js --push-only v1.2.2

# æ‰‹åŠ¨æ›´æ–° docker-compose.yml
sed -i.backup "s|image: .*/blog:.*|image: crpi-6a105b9464djyzkq.cn-chengdu.personal.cr.aliyuncs.com/jasonblog/blog:v1.2.2|g" docker-compose.yml
```

## ä¸éƒ¨ç½²æµç¨‹é›†æˆ

æ„å»ºå®Œæˆåï¼Œå¯ä»¥è§¦å‘ GitHub Actions éƒ¨ç½²ï¼š

```bash
# 1. æ„å»ºå¹¶æ¨é€é•œåƒ
npm run docker:build -- -v v1.2.3

# 2. æäº¤é…ç½®æ–‡ä»¶å˜æ›´
git add docker-compose.yml
git commit -m "update: æ›´æ–°é•œåƒç‰ˆæœ¬åˆ° v1.2.3"
git push

# 3. è§¦å‘éƒ¨ç½²
# åœ¨ GitHub ä»“åº“çš„ Actions é¡µé¢æ‰‹åŠ¨è§¦å‘éƒ¨ç½²å·¥ä½œæµ
```

## è„šæœ¬ç»´æŠ¤

å¦‚éœ€ä¿®æ”¹è„šæœ¬é…ç½®ï¼Œä¸»è¦å…³æ³¨ä»¥ä¸‹æ–‡ä»¶ï¼š
- `build-and-push.js`: å®Œæ•´åŠŸèƒ½è„šæœ¬
- `quick-build.js`: å¿«é€Ÿæ„å»ºè„šæœ¬
- `package.json`: npm è„šæœ¬é…ç½® 